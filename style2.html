<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wakefield Central Mosque - Prayer Timetable</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Work+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --surface-color: #242424;
            --primary-color: #bf9456;
            --text-color: #e0e0e0;
            --text-secondary-color: #a0a0a0;
            --highlight-color: #d4af37;

            /* "Super Responsive" Fluid Sizing using vmin (viewport's smallest dimension) */
            --font-size-xs: clamp(0.7rem, 1.8vmin, 1rem);
            --font-size-sm: clamp(0.8rem, 2.4vmin, 1.2rem);
            --font-size-md: clamp(1rem, 3.5vmin, 1.8rem);
            --font-size-lg: clamp(1.4rem, 6vmin, 3rem);
            --font-size-xl: clamp(1.8rem, 7vmin, 3.5rem);
            --font-size-xxl: clamp(4rem, 18vmin, 10rem);
        }

        /* --- Base & Layout --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Work Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            padding: 1.5vmin;
            overflow: hidden;
            background-image: radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .font-teko {
            font-family: 'Teko', sans-serif;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .header, .footer { flex-shrink: 0; }

        .main-content {
            flex-grow: 1;
            display: flex;
            gap: 1.5vmin;
            margin: 1.5vmin 0;
            min-height: 0;
            /* LANDSCAPE-FIRST: Default to a two-column row layout */
            flex-direction: row;
        }

        .left-panel, .right-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5vmin;
            min-width: 0;
        }
        .left-panel { flex: 4; }
        .right-panel {
            flex: 5;
            background-color: var(--surface-color);
            border-radius: 1.5vmin;
            padding: 2.5vmin;
        }
        
        /* On screens that are taller than they are wide, stack the main content */
        @media (orientation: portrait) {
            .main-content { flex-direction: column; }
        }

        /* --- Header Elements --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1vmin 2.5vmin;
            background-color: var(--surface-color);
            border-radius: 1.5vmin;
        }
        .logo img { height: 8vmin; }
        .logo-recolor { filter: invert(75%) sepia(13%) saturate(1558%) hue-rotate(359deg) brightness(91%) contrast(88%); }

        #fullscreen-btn {
            background: none; border: none; color: var(--text-secondary-color);
            cursor: pointer; padding: 0.5rem; transition: color 0.2s;
        }
        #fullscreen-btn:hover { color: var(--primary-color); }
        #fullscreen-btn svg { width: 3.5vmin; height: 3.5vmin; }
        
        /* Hide button when in fullscreen */
        :fullscreen #fullscreen-btn { display: none; }
        :-webkit-full-screen #fullscreen-btn { display: none; }
        :-moz-full-screen #fullscreen-btn { display: none; }

        /* --- Left Panel (Clock & Message) --- */
        .clock-display {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: var(--surface-color);
            border-radius: 1.5vmin;
            min-height: 0;
        }
        .main-digital-clock { font-size: var(--font-size-xxl); line-height: 0.9; color: var(--text-color); }
        .main-date-display { font-size: var(--font-size-sm); color: var(--text-secondary-color); }

        .message-box {
            text-align: center;
            background-color: var(--surface-color);
            padding: 2vmin;
            border-radius: 1.5vmin;
            flex-shrink: 0;
        }
        .quran-verse { font-size: var(--font-size-sm); font-style: italic; color: var(--text-secondary-color); }
        .quran-ref { font-size: var(--font-size-xs); color: var(--primary-color); margin-top: 0.5vmin; }
        
        /* --- Right Panel --- */
        .prayer-list {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: space-around;
        }
        .prayer-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1.2vmin 2.5vmin; border-radius: 1vmin;
            border-left: 5px solid transparent;
            transition: all 0.3s ease-in-out;
        }
        .prayer-name { font-size: var(--font-size-lg); font-weight: 600; flex-basis: 40%; }
        .prayer-times { display: flex; justify-content: space-around; flex-basis: 60%; text-align: center; }
        .time-block-label { font-size: var(--font-size-sm); color: var(--text-secondary-color); }
        .time-block-time { font-size: var(--font-size-xl); line-height: 1.1; }
        
        .prayer-item.active {
            background: linear-gradient(90deg, rgba(191,148,86,0.15), transparent);
            border-left-color: var(--highlight-color);
        }
        .prayer-item.active .time-block-time { color: var(--primary-color); font-weight: 600; }

        .info-cards-bottom { 
            display: flex; gap: 1.5vmin; margin-top: auto; 
            padding-top: 1.5vmin; flex-shrink: 0;
        }
        .info-card {
            flex: 1; text-align: center; background-color: var(--bg-color);
            padding: 1.5vmin; border-radius: 1.5vmin;
        }
        .info-card-title { font-size: var(--font-size-sm); color: var(--text-secondary-color); }
        .info-card-time { font-size: var(--font-size-md); color: var(--primary-color); line-height: 1.2; }
        
        /* --- Footer --- */
        .footer {
            text-align: center; padding: 1.2vmin; background-color: var(--primary-color);
            color: #000; border-radius: 1.5vmin;
            font-weight: 600; font-size: var(--font-size-sm);
        }

        /* --- Phone Off Modal --- */
        .phone-off-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; transition: opacity 0.5s ease;
        }
        .phone-off-overlay.visible { display: flex; opacity: 1; }
        .phone-icon { width: 15vmax; height: 15vmax; margin-bottom: 2rem; }
        .phone-off-text { font-size: 5vmax; font-weight: bold; text-align: center; }
        .overlay-clock { font-size: 3vmax; color: var(--text-secondary-color); }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <img src="https://www.wakefieldcentralmosque.co.uk/assets/img/img/logo-mosque.svg" alt="Wakefield Central Mosque Logo" class="logo-recolor">
        </div>
        <button id="fullscreen-btn" title="Enter Fullscreen">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707m4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707m0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707m-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707"/>
            </svg>
        </button>
    </header>

    <main class="main-content">
        <div class="left-panel">
            <div class="clock-display">
                <div id="main-digital-clock" class="main-digital-clock font-teko">--:--:--</div>
                <div class="main-date-display">
                    <span id="gregorian-date">---</span> | <span id="hijri-date">---</span>
                </div>
            </div>
            <div class="message-box">
                <p class="quran-verse">"The mosques of Allah are only to be maintained by those who believe in Allah and the Last Day..."</p>
                <p class="quran-ref font-teko">(Quran 9:18)</p>
            </div>
        </div>
        <div class="right-panel">
            <div id="prayer-list" class="prayer-list">
                <!-- Prayer items will be dynamically inserted here -->
            </div>
             <div class="info-cards-bottom">
                <div class="info-card">
                    <div class="info-card-title">Sunrise</div>
                    <div class="info-card-time font-teko" id="sunrise-time">--:--</div>
                </div>
                <div class="info-card">
                    <div class="info-card-title">Zawwal</div>
                    <div class="info-card-time font-teko" id="zawwal-time">--:--</div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        Please donate generously to support your Masjid.
    </footer>

    <div id="phone-off-overlay" class="phone-off-overlay">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-phone-slash-fill phone-icon" viewBox="0 0 16 16">
            <path d="M3 2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm6 11a1 1 0 1 0-2 0 1 1 0 0 0 2 0"/>
            <path d="m1.146 1.146.708.708a1 1 0 0 0 0 1.414l.708.708L1.146 1.146Zm1.414 1.414 11 11 .708-.708-11-11-.708.708Z"/>
        </svg>
        <div class="phone-off-text">Please Silence Your Phone</div>
        <div class="overlay-clock font-teko" id="overlay-clock">--:--:--</div>
    </div>

    <script type="module">
        // --- Firebase Initialization ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDuq7jYQcKDKY3UWNxQwP51fKRwjCERuvo",
            authDomain: "wakefield-central-mosque.firebaseapp.com",
            projectId: "wakefield-central-mosque",
            storageBucket: "wakefield-central-mosque.appspot.com",
            messagingSenderId: "998395111777",
            appId: "1:998395111777:web:5492302e7279822d5cbd20",
            measurementId: "G-NXER4ENDE0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const elements = {
            mainDigitalClock: document.getElementById('main-digital-clock'),
            gregorianDate: document.getElementById('gregorian-date'),
            hijriDate: document.getElementById('hijri-date'),
            prayerList: document.getElementById('prayer-list'),
            sunriseTime: document.getElementById('sunrise-time'),
            zawwalTime: document.getElementById('zawwal-time'),
            phoneOffOverlay: document.getElementById('phone-off-overlay'),
            overlayClock: document.getElementById('overlay-clock'),
            fullscreenBtn: document.getElementById('fullscreen-btn'),
        };

        // --- State Variables ---
        let prayerTimesData = {};
        let jamaatTimesData = {};

        // --- Utility Functions ---
        const formatTime12h = (timeStr) => {
            if (!timeStr || !timeStr.includes(':')) return '--:--';
            const [hours, minutes] = timeStr.split(':');
            let h = parseInt(hours, 10);
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            return `${String(h)}:${minutes} ${ampm}`;
        };

        const timeToMinutes = (timeStr) => {
            if (!timeStr || !timeStr.includes(':')) return null;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        };

        const minutesToTime24h = (minutes) => {
            if (minutes === null || isNaN(minutes) || minutes < 0) return null;
            const h = Math.floor(minutes / 60) % 24;
            const m = minutes % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        };

        // --- Data Fetching ---
        const fetchHijriDate = async () => {
            try {
                const today = new Date();
                const d = String(today.getDate()).padStart(2, '0');
                const m = String(today.getMonth() + 1).padStart(2, '0');
                const y = today.getFullYear();
                const response = await fetch(`https://api.aladhan.com/v1/gToH?date=${d}-${m}-${y}`);
                if (!response.ok) throw new Error('Network response failed');
                const data = await response.json();
                if (data.code === 200 && data.data.hijri) {
                    elements.hijriDate.textContent = `${data.data.hijri.day} ${data.data.hijri.month.en} ${data.data.hijri.year}H`;
                }
            } catch (error) {
                console.error("Could not fetch Hijri date:", error);
                elements.hijriDate.textContent = 'Could not load Hijri date';
            }
        };

        const setupPrayerTimeListeners = () => {
            const firestorePath = `artifacts/masjid-connect-app/public/data`;
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const calendarDocId = `${day}-${month}`;

            onSnapshot(doc(db, `${firestorePath}/prayerTimes/today`), (doc) => {
                if (doc.exists()) {
                    jamaatTimesData = doc.data();
                    updateUI();
                }
            });

            onSnapshot(doc(db, `${firestorePath}/prayerCalendar/${calendarDocId}`), (doc) => {
                if (doc.exists()) {
                    prayerTimesData = doc.data();
                    updateUI();
                }
            });
        };

        // --- UI Update Logic ---
        const updateUI = () => {
            if (Object.keys(prayerTimesData).length === 0 || Object.keys(jamaatTimesData).length === 0) return;

            elements.prayerList.innerHTML = '';
            const prayerOrder = ['Fajr', 'Zuhr', 'Asr', 'Maghrib', 'Isha', 'Jummah'];

            prayerOrder.forEach(prayer => {
                const item = document.createElement('div');
                item.className = 'prayer-item';
                item.id = `item-${prayer.toLowerCase()}`;
                
                let itemHtml = '';

                if (prayer === 'Jummah') {
                    const jamaat1 = formatTime12h(jamaatTimesData.Jumma);
                    const jamaat2 = formatTime12h(jamaatTimesData.Jumma2);
                    itemHtml = `
                        <div class="prayer-name font-teko">Jummah</div>
                        <div class="prayer-times">
                            <div class="time-block">
                                <div class="time-block-label">1st Jama'at</div>
                                <div class="time-block-time font-teko">${jamaat1}</div>
                            </div>
                            <div class="time-block">
                                <div class="time-block-label">2nd Jama'at</div>
                                <div class="time-block-time font-teko">${jamaat2}</div>
                            </div>
                        </div>`;
                } else {
                    const prayerKey = prayer;
                    const start = formatTime12h(prayerTimesData[prayerKey]);
                    const jamaat = prayer === 'Maghrib' ? start : formatTime12h(jamaatTimesData[prayerKey]);
                    
                    itemHtml = `
                        <div class="prayer-name font-teko">${prayer}</div>
                        <div class="prayer-times">
                            <div class="time-block">
                                <div class="time-block-label">Start</div>
                                <div class="time-block-time font-teko">${start}</div>
                            </div>
                            <div class="time-block">
                                <div class="time-block-label">Jama'at</div>
                                <div class="time-block-time font-teko">${jamaat}</div>
                            </div>
                        </div>`;
                }
                
                item.innerHTML = itemHtml;
                elements.prayerList.appendChild(item);
            });

            elements.sunriseTime.textContent = formatTime12h(prayerTimesData.Sunrise);
            const zuhrStartMinutes = timeToMinutes(prayerTimesData.Zuhr);
            elements.zawwalTime.textContent = formatTime12h(minutesToTime24h(zuhrStartMinutes - 10));
        };

        const highlightCurrentPrayer = () => {
            if (Object.keys(prayerTimesData).length === 0) return;
            const now = new Date();
            const nowMinutes = now.getHours() * 60 + now.getMinutes();
            const isFriday = now.getDay() === 5;
            
            const activePrayerOrder = isFriday 
                ? ['Fajr', 'Jummah', 'Asr', 'Maghrib', 'Isha'] 
                : ['Fajr', 'Zuhr', 'Asr', 'Maghrib', 'Isha'];

             const times = activePrayerOrder.map(p => ({ 
                name: p, 
                start: timeToMinutes(prayerTimesData[(p === 'Jummah' ? 'Zuhr' : p)]) 
            })).filter(p => p.start !== null).sort((a, b) => a.start - b.start);

            let currentPrayerName = '';
            if (times.length > 0) {
                 if (nowMinutes >= times[times.length - 1].start || nowMinutes < times[0].start) {
                    currentPrayerName = times[times.length - 1].name;
                } else {
                    for (let i = 0; i < times.length - 1; i++) {
                        if (nowMinutes >= times[i].start && nowMinutes < times[i + 1].start) {
                            currentPrayerName = times[i].name;
                            break;
                        }
                    }
                }
            }

            document.querySelectorAll('.prayer-item').forEach(row => row.classList.remove('active'));
            if (currentPrayerName) {
                const currentItem = document.getElementById(`item-${currentPrayerName.toLowerCase()}`);
                if (currentItem) currentItem.classList.add('active');
            }
        };

        const checkPhoneOffMessage = () => {
            if (Object.keys(jamaatTimesData).length === 0 || Object.keys(prayerTimesData).length === 0) return;
            const now = new Date();
            const nowMinutes = now.getHours() * 60 + now.getMinutes();
            let showOverlay = false;
            
            const jamaatTimes = [
                jamaatTimesData.Fajr, jamaatTimesData.Zuhr, jamaatTimesData.Asr, 
                prayerTimesData.Maghrib, // Use start time for Maghrib jamaat
                jamaatTimesData.Isha,
                jamaatTimesData.Jumma, jamaatTimesData.Jumma2
            ].map(timeToMinutes).filter(t => t !== null);

            for (const jamaat of jamaatTimes) {
                if (nowMinutes >= jamaat - 1 && nowMinutes <= jamaat + 5) {
                    showOverlay = true;
                    break;
                }
            }
            
            elements.phoneOffOverlay.classList.toggle('visible', showOverlay);
        };

        const updateClock = () => {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-GB');
            elements.mainDigitalClock.textContent = timeString;
            elements.overlayClock.textContent = timeString;
        };

        // --- Fullscreen Logic ---
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
        
        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            elements.gregorianDate.textContent = new Date().toLocaleDateString('en-GB', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            fetchHijriDate();
            setupPrayerTimeListeners();
            
            elements.fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            updateClock();
            highlightCurrentPrayer();

            setInterval(() => {
                updateClock();
                highlightCurrentPrayer();
                checkPhoneOffMessage();
            }, 1000);
        });
    </script>
</body>
</html>


